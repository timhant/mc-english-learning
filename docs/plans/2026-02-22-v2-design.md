# MC English Learning Addon v2.0 设计文档
*日期：2026-02-22*
*状态：已确认*

## 概述
将英语启蒙 Addon 从 55 词的平面结构升级为 200+ 词的分级主题系统，新增预录语音朗读功能。目标用户：5-8 岁儿童。

## 核心改动

### 1. 分主题等级系统（5级）

| 等级 | 主题 | 内容 | 约词数 |
|------|------|------|--------|
| ⭐ Lv1 | 农场生活 | 常见动物、基础方块、基础物品（苹果、面包、床、门、火把） | 35 |
| ⭐⭐ Lv2 | 探索自然 | 更多动物、自然方块、花和树种类 | 45 |
| ⭐⭐⭐ Lv3 | 矿工之路 | 矿石全家族、工具、装备、食物烹饪 | 45 |
| ⭐⭐⭐⭐ Lv4 | 勇者战斗 | 怪物、战斗词汇、药水、附魔台 | 45 |
| ⭐⭐⭐⭐⭐ Lv5 | 大师工坊 | 红石机械、酿造、末地/下界方块、村民交易、高级建筑 | 45 |

**升级机制**：当前等级解锁词数 ÷ 当前等级总词数 ≥ 阈值（默认 0.8）→ 自动升级，触发庆祝动画。

### 2. 触发规则

- **实体（动物/怪物/NPC）**：贴近 2 格内触发，冷却 60 秒
- **方块**：仅破坏/放置时触发（不靠近触发），冷却 60 秒
- 只有当前等级的词汇会触发显示

### 3. 语音朗读系统

**音频生成**：CosyVoice 批量生成，每个词 2 个文件（英文 + 中文），.ogg 格式，48kHz mono。

**播放时序**：
```
T+0.0s  大标题 "COW" + playsound eng.cow_en（英文朗读）
T+0.5s  副标题 "奶牛 /kaʊ/"
T+1.5s  playsound eng.cow_cn（中文朗读）
```

**预估体积**：200+ 词 × 2 音频 ≈ 400 文件 ≈ 5-10MB

### 4. 外置配置文件

`config.json`（behavior_pack 根目录）：
```json
{
  "unlockThreshold": 0.8,
  "cooldownSeconds": 60,
  "detectRange": 2,
  "questIntervalSeconds": 300,
  "questTimeoutSeconds": 300,
  "voiceEnabled": true,
  "maxLevel": 5
}
```

## 文件结构

```
EnglishLearning_BP/
  manifest.json
  config.json
  scripts/
    main.js
    config.js          # 读取 config.json
    proximity.js       # 实体靠近检测（2格）
    blockLearn.js      # 方块交互检测
    quest.js           # 寻找任务系统
    progress.js        # 进度追踪 + 等级系统
    levelUp.js         # 升级动画/奖励
    voice.js           # 语音播放调度
    vocab/
      index.js         # 汇总导出 + 按等级构建 Map
      level1.js        # 农场生活
      level2.js        # 探索自然
      level3.js        # 矿工之路
      level4.js        # 勇者战斗
      level5.js        # 大师工坊

EnglishLearning_RP/
  manifest.json
  sounds/
    sound_definitions.json
    eng/
      cow_en.ogg
      cow_cn.ogg
      pig_en.ogg
      pig_cn.ogg
      ...
```

## 玩家进度数据

存储在 `world.getDynamicProperty`：
```js
{
  level: 1,
  unlocked: {
    level1: ["minecraft:cow", ...],
    level2: [], level3: [], level4: [], level5: []
  },
  totalWords: 3,
  questsCompleted: 5
}
```

## 技术约束（BDS 1.26 踩坑）

- ❌ `player.runCommandAsync()` 不存在 → 用 `dimension.runCommand()`
- ❌ `player.isValid()` 不存在 → 用 try-catch
- ❌ `world.beforeEvents.chatSend` 不存在 → 用 `afterEvents`
- ✅ 选择器用 `@a[name="..."]` 而非 `"PlayerName"`
- ✅ `dimension.runCommand()` 是同步的，可靠

## 实施计划

### Phase 1: 词汇扩充 + 等级系统
1. 编写 5 级词汇表（~215 词）
2. 重构 vocabulary 为分级模块
3. 实现等级检测 + 升级逻辑
4. 添加 config.json 配置系统
5. 调整 detectRange 为 2 格

### Phase 2: 语音朗读
1. 编写音频生成脚本（调用 CosyVoice API）
2. 批量生成 ~430 个 .ogg 文件
3. 编写 sound_definitions.json
4. 实现 voice.js 播放调度（延时序列）
5. 更新 resource_pack manifest

### Phase 3: 测试 + 发布
1. 服务器部署测试
2. 验证所有等级触发/升级/语音
3. 更新 GitHub + README
4. 发布 v2.0.0
